pipeline {
    agent any
    
    tools {
        maven 'maven3'
    }
    
    environment {
        SCANNER_HOME = tool 'sonar-scanner'
    }

    stages {
        stage('git checkout') {
            steps {
               git 'https://github.com/HariNair85/maven-web-application.git'
            }
        }
        
        stage ('soanrqube analysis') {
            steps {
                withSonarQubeEnv('sonar-installation') {
                   sh ''' $SCANNER_HOME/bin/sonar-scanner -Dsonar.projectKey=maven-app-code-quality -Dsonar.projectName=maven-app-code-quality '''
                 }
            }
        }
    }
    
    post {
        success {
            emailext(
                subject: "SUCCESS: SonarQube quality gate passed",
                body:"""
                Hi team,
                
                The sonarqube quality gate passed successfully.
                you can view the report here:
                http://52.66.206.190:9000/
                username: admin, passwd: pass
                
                Regards,
                Team DevOps,
                clahan Technologies pvt ltd.
                """,
                to: 'harinair1985@outlook.com'
                )
        }
        failure{
            emailext(
                subject: 'Failed: sonarqube quality gate',
                body:"""
                
                Hi Team
                
                The sonarqube quality gate has failed.
                
                Please check the below details
                
                http://52.66.206.190:9000/
                username: admin, passwd: pass
                
                Regards,
                Team DevOps
                """,
                to: 'harinair1985@outlook.com'
                )
        }
    }
}
